<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VDFY Admin Panel</title>
    <style>
        :root { --primary: #1a73e8; --bg: #f4f6f8; --text: #202124; }
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: var(--text); height: 100vh; display: flex; flex-direction: column;}
        
        /* LOGIN SCREEN */
        #login-screen { display: flex; flex: 1; align-items: center; justify-content: center; flex-direction: column; }
        .login-box { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center; width: 300px; }
        .google-btn { background: #4285F4; color: white; border: none; padding: 12px 24px; border-radius: 4px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; width: 100%; font-size: 16px; margin-top: 20px;}
        .google-btn:hover { background: #357ae8; }

        /* DASHBOARD (Hidden by default) */
        #app-screen { display: none; height: 100%; display: none; flex-direction: row; }
        
        /* SIDEBAR */
        .sidebar { width: 250px; background: white; border-right: 1px solid #ddd; padding: 20px; display: flex; flex-direction: column; }
        .logo { font-size: 24px; font-weight: 800; color: var(--primary); margin-bottom: 40px; }
        .nav-item { padding: 12px 15px; margin-bottom: 5px; border-radius: 8px; cursor: pointer; color: #5f6368; font-weight: 500; display: flex; gap: 10px; }
        .nav-item:hover { background: #f1f3f4; }
        .nav-item.active { background: #e8f0fe; color: var(--primary); }
        .user-info { margin-top: auto; padding-top: 20px; border-top: 1px solid #eee; font-size: 13px; color: #666; }
        .logout-link { color: #ea4335; cursor: pointer; margin-top: 5px; display: block; }

        /* CONTENT */
        .main { flex: 1; padding: 30px; overflow-y: auto; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .folder-header { margin-top: 30px; margin-bottom: 15px; border-bottom: 2px solid #ddd; padding-bottom: 5px; font-size: 18px; font-weight: bold; color: #444; }
        
        .loading { text-align: center; margin-top: 50px; color: #666; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <h1 style="margin:0; color:#1a73e8;">VDFY Admin</h1>
            <p>Secure Video Dashboard</p>
            <button class="google-btn" onclick="signIn()">
                Sign in with Google
            </button>
        </div>
    </div>

    <div id="app-screen">
        <div class="sidebar">
            <div class="logo">üé• VDFY</div>
            <div class="nav-item active">üìÇ My Videos</div>
            <div class="nav-item" onclick="alert('Coming in Module M2.4')">üìä Analytics (Beta)</div>
            
            <div class="user-info">
                <div id="user-name">Loading...</div>
                <span class="logout-link" onclick="logout()">Sign Out</span>
            </div>
        </div>
        <div class="main">
            <div id="content-area" class="grid"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // üëáüëáüëá –í–°–¢–ê–í –°–Æ–î–ò –°–í–Ü–ô –ö–û–ù–§–Ü–ì –ó M1.1 üëáüëáüëá
        const firebaseConfig = {
  apiKey: "AIzaSyDBUbYLkuMMQaKHomNursjJ1zoFNtIZjy4",
  authDomain: "vdfy-auth-system.firebaseapp.com",
  projectId: "vdfy-auth-system",
  storageBucket: "vdfy-auth-system.firebasestorage.app",
  messagingSenderId: "381929137400",
  appId: "1:381929137400:web:661c3b07907e639fa5070d"
};
        // üëÜüëÜüëÜ –í–°–¢–ê–í –°–Æ–î–ò –°–í–Ü–ô –ö–û–ù–§–Ü–ì üëÜüëÜüëÜ

        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const provider = new GoogleAuthProvider();

        // –ï–ª–µ–º–µ–Ω—Ç–∏ UI
        const loginScreen = document.getElementById('login-screen');
        const appScreen = document.getElementById('app-screen');
        const userNameEl = document.getElementById('user-name');
        const contentArea = document.getElementById('content-area');

        // 1. –§—É–Ω–∫—Ü—ñ—è –≤—Ö–æ–¥—É
        window.signIn = () => {
            signInWithPopup(auth, provider).catch(err => alert(err.message));
        };

        // 2. –§—É–Ω–∫—Ü—ñ—è –≤–∏—Ö–æ–¥—É
        window.logout = () => signOut(auth);

        // 3. –°–ª—É—Ö–∞—î–º–æ –∑–º—ñ–Ω–∏ —Å—Ç–∞—Ç—É—Å—É (–£–≤—ñ–π—à–æ–≤/–í–∏–π—à–æ–≤)
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // –Æ–∑–µ—Ä —É–≤—ñ–π—à–æ–≤
                loginScreen.style.display = 'none';
                appScreen.style.display = 'flex';
                userNameEl.textContent = user.email;
                
                // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –≤—ñ–¥–µ–æ
                loadVideos(user);
            } else {
                // –Æ–∑–µ—Ä –≤–∏–π—à–æ–≤
                loginScreen.style.display = 'flex';
                appScreen.style.display = 'none';
                contentArea.innerHTML = '';
            }
        });

        // 4. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—ñ–¥–µ–æ –∑ —Å–µ—Ä–≤–µ—Ä–∞
        async function loadVideos(user) {
            contentArea.innerHTML = '<div class="loading">Loading your secure videos...</div>';
            
            // –û—Ç—Ä–∏–º—É—î–º–æ "—Å–≤—ñ–∂–∏–π" —Ç–æ–∫–µ–Ω
            const token = await user.getIdToken();

            try {
                // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –∑–∞–ø–∏—Ç –∑ –¢–û–ö–ï–ù–û–ú
                const res = await fetch('/api/videos', {
                    headers: {
                        'Authorization': `Bearer ${token}` // <--- –û–°–¨ –í–û–ù–ê, –ü–ï–†–ï–ü–£–°–¢–ö–ê!
                    }
                });
                
                if (res.status === 401) throw new Error("Unauthorized");
                
                const folders = await res.json();
                renderVideos(folders);
            } catch (err) {
                console.error(err);
                contentArea.innerHTML = `<div class="loading" style="color:red">Error: ${err.message}</div>`;
            }
        }

        function renderVideos(folders) {
            contentArea.innerHTML = '';
            if (Object.keys(folders).length === 0) {
                contentArea.innerHTML = '<div class="loading">No videos yet. Record one!</div>';
                return;
            }

            for (const [folderName, videos] of Object.entries(folders)) {
                // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–∞–ø–∫–∏
                const header = document.createElement('div');
                header.className = 'folder-header';
                header.style.gridColumn = '1 / -1';
                header.textContent = `üìÇ ${folderName}`;
                contentArea.appendChild(header);

                // –í—ñ–¥–µ–æ
                videos.forEach(vid => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerHTML = `
                        <div style="position:relative; padding-top:56.25%; background:black;">
                            <video controls style="position:absolute; top:0; left:0; width:100%; height:100%;">
                                <source src="${vid.url}" type="video/webm">
                            </video>
                        </div>
                        <div style="padding:15px;">
                            <div style="font-size:12px; color:#999;">${new Date(vid.lastModified).toLocaleString()}</div>
                            <a href="${vid.url}" target="_blank" style="display:block; margin-top:5px; color:#1a73e8; text-decoration:none;">Open Link üîó</a>
                        </div>
                    `;
                    contentArea.appendChild(card);
                });
            }
        }
    </script>
</body>
</html>